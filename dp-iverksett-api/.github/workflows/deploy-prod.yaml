#name: Build-Deploy prod
#on:
#  push:
#    branches:
#      - main
#env:
#  IMAGE: ghcr.io/navikt/dp-iverksett:${{ github.sha }}
#
#jobs:
#  build:
#    name: Build, push and deploy to prod-gcp
#    runs-on: ubuntu-latest
#    steps:
#      - name: Checkout code
#        uses: actions/checkout@v3
#      - name: Read/save maven cache
#        uses: actions/cache@v3
#        with:
#          path: ~/.m2/repository
#          key: ${{ runner.os }}-maven-cache-dp-iverksett-${{ hashFiles('**/pom.xml') }}
#          restore-keys: |
#            ${{ runner.os }}-maven-cache-dp-iverksett-
#            ${{ runner.os }}-
#      - name: Set up JDK 17
#        uses: actions/setup-java@v3
#        with:
#          distribution: 'temurin'
#          java-version: '17'
#      - name: Bygg med Maven
#        env:
#          GITHUB_USERNAME: x-access-token
#          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
#        run: mvn -B --no-transfer-progress package --settings .m2/maven-settings.xml --file pom.xml
#      - name: Build and publish Docker image
#        env:
#          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
#        run: |
#          echo ${GITHUB_TOKEN} | docker login ghcr.io --username ${GITHUB_REPOSITORY} --password-stdin
#          docker build --tag ${IMAGE} .
#          docker push ${IMAGE}
#      - name: Post deploy failures to Slack
#        if: failure()
#        run: |
#          curl -X POST --data "{\"text\": \"Build av $GITHUB_REPOSITORY feilet - $GITHUB_SERVER_URL/$GITHUB_REPOSITORY/actions/runs/$GITHUB_RUN_ID\"}" $WEBHOOK_URL
#        env:
#          WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
#  deploy:
#    name: Deploy to GCP
#    needs: build
#    runs-on: ubuntu-latest
#    steps:
#      - uses: actions/checkout@v3
#      - name: Deploy til dev-gcp
#        uses: nais/deploy/actions/deploy@v1
#        env:
#          APIKEY: ${{ secrets.NAIS_DEPLOY_APIKEY }}
#          CLUSTER: dev-gcp
#          RESOURCE: .deploy/nais-preprod.yaml
#      - name: Deploy til prod-gcp
#        uses: nais/deploy/actions/deploy@v1
#        env:
#          APIKEY: ${{ secrets.NAIS_DEPLOY_APIKEY }}
#          CLUSTER: prod-gcp
#          RESOURCE: .deploy/nais-prod.yaml
#      - name: Post deploy failures to Slack
#        if: failure()
#        run: |
#          curl -X POST --data "{\"text\": \"Deploy av $GITHUB_REPOSITORY feilet - $GITHUB_SERVER_URL/$GITHUB_REPOSITORY/actions/runs/$GITHUB_RUN_ID\"}" $WEBHOOK_URL
#        env:
#          WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}